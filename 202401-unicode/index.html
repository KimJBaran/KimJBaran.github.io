<!DOCTYPE html><html lang="en" class="font-serif
		leading-6
		text-content-text
		bg-gradient-to-r
		from-background-start
		via-background-middle
		to-background-end"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.0.5"><!-- Font preloads --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Serif:ital,wght@0,100..900;1,100..900&family=Figtree:ital,wght@0,300;1,300&family=Major+Mono+Display&display=swap" rel="stylesheet"><!-- Canonical URL --><link rel="canonical" href="https://kimjbaran.github.io/202401-unicode/"><!-- Primary Meta Tags --><title>Kim&#39;s Blog</title><meta name="title" content="Kim's Blog"><meta name="description" content="Blog of Joachim &#34;Kim&#34; Baran"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://kimjbaran.github.io/202401-unicode/"><meta property="og:title" content="Kim's Blog"><meta property="og:description" content="Blog of Joachim &#34;Kim&#34; Baran"><meta property="og:image" content="https://kimjbaran.github.io/blog-placeholder-1.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://kimjbaran.github.io/202401-unicode/"><meta property="twitter:title" content="Kim's Blog"><meta property="twitter:description" content="Blog of Joachim &#34;Kim&#34; Baran"><meta property="twitter:image" content="https://kimjbaran.github.io/blog-placeholder-1.jpg"><link rel="stylesheet" href="/_astro/_slug_.BlVpt609.css">
<style>[data-astro-image]{width:100%;height:auto;-o-object-fit:var(--fit);object-fit:var(--fit);-o-object-position:var(--pos);object-position:var(--pos);aspect-ratio:var(--w) / var(--h)}[data-astro-image=responsive]{max-width:calc(var(--w) * 1px);max-height:calc(var(--h) * 1px)}[data-astro-image=fixed]{width:calc(var(--w) * 1px);height:calc(var(--h) * 1px)}
</style></head> <body> <header class="text-base"> <nav class="flex
		font-sans
		space-x-8
		px-8
		py-2"> <a href="/"> Posts </a> <a href="/about"> About </a> </nav> <div style="min-height: 1px" class="bg-gradient-to-r
			from-[#d0d0d0]
			via-[#b0b0b0]
			to-[#b0b0b0]"></div> </header> <main class="m-8 md:m-16 lg:m-32
			flex
			text-content-text
			justify-center">  <article class="max-w-[500px]"> <div class="my-10"> <h1 class="text-2xl
        font-sans
        text-nowrap
        leading-8
        relative
        top-[74px]
        -left-[10px]
        overflow-x-clip
        tracking-widest
        z-10
        -mt-[74px]
        w-[37px]"> <span class="text-[#ff00aa] text-[100px] font-initial">C</span> </h1> <h1 class="text-2xl
        underline decoration-solid decoration-decoration
        font-sans
        relative
        top-0
        -left-[10px]
        leading-8"> <span class="text-[#af0075] text-[100px] font-initial">C</span><span class="-ml-[6px]">ommon Unicode encoding pitfalls</span> </h1> <p class="text-content-date
					w-full
					mt-[5px]
					ml-[-10px]
					pl-[10px]"> <time datetime="2025-01-02T05:00:00.000Z"> Jan 2, 2025 </time> </p>  </div> <div class="prose
    max-w-[500px]
    text-base
    leading-6
    text-content-text
    prose-a:text-[#444444]
    prose-code:font-normal
    prose-h1:font-sans
    prose-h1:font-normal
    prose-h1:text-2xl
    prose-h1:leading-8
    prose-h1:text-content-heading
    prose-h2:font-sans
    prose-h2:font-normal
    prose-h2:text-xl
    prose-h2:leading-7
    prose-h2:text-content-heading
    prose-a:text-[#4c76ab]
    prose-p:text-justify
    prose-img:rounded-xl">   <p><a href="https://en.wikipedia.org/wiki/Unicode">Unicode</a> is a character encoding standard thatâ€™s widely used. It maps bytes to letters, numbers, emoji, etc., for us humans to read. Iâ€™m sure there are still exceptions where youâ€™ll find other character encodings, but for anything web, mobile, or desktop related youâ€™ll be dealing with Unicode. At a surface level this makes it look like youâ€™ve to never think about character encodings ever again. After all, everything is Unicode now, right? The deceptive simplicity of Unicode makes it easy to internationalize your web-site or app, but there are plenty of edge cases that youâ€™ll need to be aware of.</p>
<p>What are character encodings? Character encodings map bytes to characters. <a href="https://en.wikipedia.org/wiki/ASCII">ASCII</a> is a great example for encoding English: it maps 95 printable characters (a-z, A-Z, 0-9, punctuation, etc.) and has mappings for 33 control codes (new line, tab, etc.). Thatâ€™s 128 encoded mappings which would fit into 7 bits, but youâ€™ll most likely only ever encounter ASCII in 8 bits â€” one byte per character with the most significant bit set to zero. Allocating a single byte per character worked fine for English texts back in the day, but that isnâ€™t nearly enough anymore in any international context.</p>
<p>Unicode can encode more than 1.1 million characters. Have a look at Unicode <a href="https://en.wikipedia.org/wiki/Plane_%28Unicode%29">Planes</a> and try to figure out how many characters it could theoretically encode, if you feel too jolly today. Since 1.1 million characters canâ€™t be encoded by a single byte, Unicode comes in three major representations:</p>
<ul>
<li>UTF-8: uses a single byte for ASCII and up to three bytes for international characters (variable width),</li>
<li>UTF-16: uses two bytes for the most common international characters, emoji, symbols, etc., but can double to four bytes when needed (variable width),</li>
<li>UTF-32: always uses four bytes to encode a character (fixed width), and</li>
<li>a few more representations that are rare. Have a look at <a href="https://en.wikipedia.org/wiki/UTF-EBCDIC">UTF-EBCDIC</a>, if you fancy <a href="https://en.wikipedia.org/wiki/Punched_card">punch cards</a>.</li>
</ul>
<p>Before diving in deeper, I want to point out two things that I wonâ€™t address here:</p>
<ul>
<li>Unicodeâ€™s quirk that allows some character to be represented by different code points (for example, â€œÃªâ€ can be both <code>U+00EA</code> and <code>U+0065 U+0302</code>), and</li>
<li><a href="https://en.wikipedia.org/wiki/Endianness">endianness</a> that handles whether the most-significant or least-significant byte is stored first.</li>
</ul>
<p>The first issue may cause your app to return empty search results even though the â€œrightâ€ characters were entered by your users. It just happens that their internal representation in Unicode doesnâ€™t match. The second issue is a problem when loading/saving data across different operating systems or hardware architectures. Getting endianness wrong will result in entirely wrong characters to be displayed. While these are big problems, there are simpler Unicode pitfalls to watch out for. Here Iâ€™ll look at:</p>
<ul>
<li>string length, and</li>
<li>random access of individual characters within a string.</li>
</ul>
<p>Letâ€™s start with a simple case that revolves around the character â€ğŸ’–â€ which is the Unicode scalar <code>U+1F496</code>. Since Iâ€™ve copied this from the <a href="https://docs.swift.org/swift-book/documentation/the-swift-programming-language/stringsandcharacters/">Swift documentation</a> letâ€™s see how long that single character string is in Swift.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="swift"><code><span class="line"><span style="color:#F97583">%</span><span style="color:#E1E4E8"> swift repl</span></span>
<span class="line"><span style="color:#79B8FF">  1</span><span style="color:#F97583">></span><span style="color:#F97583"> let</span><span style="color:#E1E4E8"> s </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "ğŸ’–"</span></span>
<span class="line"><span style="color:#E1E4E8">s</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> String</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "ğŸ’–"</span></span>
<span class="line"><span style="color:#79B8FF">  2</span><span style="color:#F97583">></span><span style="color:#E1E4E8"> s.</span><span style="color:#79B8FF">count</span></span>
<span class="line"><span style="color:#E1E4E8">$R0</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> Int</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 1</span></span></code></pre>
<p>Nice! Swift deals with Unicode strings rather well, so there isnâ€™t any surprise here. Swift 5 <a href="https://www.swift.org/blog/utf8-string/">switched</a> from UTF-16 to UTF-8 and it perfectly handles this character thatâ€™s three bytes when encoded in UTF-8. If youâ€™re dealing with Swift a lot, then youâ€™ll notice that string operations typically involve an iterator which makes dealing with multi-byte characters possible. You lose random access of characters though.</p>
<p>How does JavaScript handle this? Even though weâ€™re writing HTML in UTF-8, JavaScript is dealing with strings in UTF-16. This needs to keep us on our toes immediately, because youâ€™ll find blogs that claim that JavaScript is UTF-8 too. It isnâ€™t. Itâ€™s complicated, but <a href="https://tc39.es/ecma262/2017/">ECMA262 4.3.17</a> calls out UTF-16 specifically. JavaScript is also very old and it has to be backwards compatible, so hereâ€™s a bit of a surprise where the heart character appears to â€œgrowâ€ into two characters:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">%</span><span style="color:#E1E4E8"> node</span></span>
<span class="line"><span style="color:#F97583">></span><span style="color:#F97583"> const</span><span style="color:#79B8FF"> s</span><span style="color:#F97583"> =</span><span style="color:#9ECBFF"> "ğŸ’–"</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">undefined</span></span>
<span class="line"><span style="color:#F97583">></span><span style="color:#E1E4E8"> s.</span><span style="color:#79B8FF">length</span></span>
<span class="line"><span style="color:#79B8FF">2</span></span>
<span class="line"><span style="color:#F97583">></span><span style="color:#E1E4E8"> s[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\ud83d</span><span style="color:#9ECBFF">'</span></span>
<span class="line"><span style="color:#F97583">></span><span style="color:#E1E4E8"> s[</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#9ECBFF">'</span><span style="color:#79B8FF">\udc96</span><span style="color:#9ECBFF">'</span></span>
<span class="line"><span style="color:#F97583">></span><span style="color:#E1E4E8"> [</span><span style="color:#F97583">...</span><span style="color:#E1E4E8">s]</span></span>
<span class="line"><span style="color:#E1E4E8">[ </span><span style="color:#9ECBFF">'ğŸ’–'</span><span style="color:#E1E4E8"> ]</span></span>
<span class="line"><span style="color:#F97583">></span><span style="color:#E1E4E8"> [</span><span style="color:#F97583">...</span><span style="color:#E1E4E8">s].</span><span style="color:#79B8FF">length</span></span>
<span class="line"><span style="color:#79B8FF">1</span></span></code></pre>
<p>JavaScript doesnâ€™t deal with Unicode well unless youâ€™re using iterators (see my use of <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax">spread syntax</a> above). You might be tempted to say that this is obvious and that random access naturally breaks when dealing with anything but UTF-32. Or does it? Letâ€™s have a look at Python:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="python"><code><span class="line"><span style="color:#F97583">%</span><span style="color:#E1E4E8"> python3</span></span>
<span class="line"><span style="color:#F97583">>>></span><span style="color:#F97583"> from</span><span style="color:#E1E4E8"> sys </span><span style="color:#F97583">import</span><span style="color:#E1E4E8"> getsizeof</span></span>
<span class="line"><span style="color:#F97583">>>></span><span style="color:#E1E4E8"> s </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "ğŸ’–"</span></span>
<span class="line"><span style="color:#F97583">>>></span><span style="color:#79B8FF"> len</span><span style="color:#E1E4E8">(s)</span></span>
<span class="line"><span style="color:#79B8FF">1</span></span>
<span class="line"><span style="color:#F97583">>>></span><span style="color:#E1E4E8"> s[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#9ECBFF">'ğŸ’–'</span></span>
<span class="line"><span style="color:#F97583">>>></span><span style="color:#E1E4E8"> getsizeof(s)</span></span>
<span class="line"><span style="color:#79B8FF">64</span></span>
<span class="line"><span style="color:#F97583">>>></span><span style="color:#E1E4E8"> s </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> "ğŸ’–ğŸ’–"</span></span>
<span class="line"><span style="color:#F97583">>>></span><span style="color:#E1E4E8"> getsizeof(s)</span></span>
<span class="line"><span style="color:#79B8FF">68</span></span></code></pre>
<p>Python returns the correct string length and it also allows random access of characters within the string. I used <code>getsizeof</code> here to figure out which character encoding Python internally uses. Itâ€™s UTF-32 (look at the four byte increment when adding a second heart). UTF-32 isnâ€™t Pythonâ€™s default character encoding though. It appears that Python dynamically changes the encoding depending on the text it needs to represent. Quite some thought went into their string handling, because Pythonâ€™s documentation also highlights and offers solutions for <a href="https://docs.python.org/3/howto/unicode.html#comparing-strings">comparing Unicode strings</a> â€” a problem that Iâ€™ve said Iâ€™d gloss over here. Like Swift, Python is rather well suited to deal with Unicode, but it still requires attention from developers to do The Right Thing.</p>
<p>Takeaways:</p>
<ul>
<li>string length might not count characters in the string</li>
<li>random access to characters in a string may not work</li>
<li>string/character comparison needs special handling</li>
<li>serialization/de-serialization across platforms is difficult</li>
</ul>
<p>I hope that this post shines some light on immediate issues that arise when dealing with Unicode. These issues are minor in comparison to the myriad of different individual character encodings that we had to deal with before Unicode, but these are still issues must be addressed.</p>   </div> </article>  </main> <footer class="flex
	flex-col
	font-sans
	text-sm
	text-footer-links
	px-4
	space-y-2
	mt-20
	mb-4"> <a class="flex self-end items-center gap-2" href="https://bsky.app/profile/kimjbaran.bsky.social" target="_blank"> <span>Bluesky</span> <svg aria-hidden="true" class="astro-yzt5nm4y astro-lq7oo3uf" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M12 10.8c-1-2.1-4-6-6.8-8C2.6 1 1.6 1.3.9 1.6.1 1.9 0 3 0 3.8c0 .7.4 5.6.6 6.4C1.4 13 4.3 14 7 13.6h.4H7c-4 .6-7.4 2-2.8 7 5 5.3 6.8-1 7.8-4.2 1 3.2 2 9.3 7.7 4.3 4.3-4.3 1.2-6.5-2.7-7a9 9 0 0 1-.4-.1h.4c2.7.3 5.6-.6 6.4-3.4.2-.8.6-5.7.6-6.4 0-.7-.1-1.9-.9-2.2-.7-.3-1.7-.7-4.3 1.2-2.8 2-5.7 5.9-6.8 8"></path></svg> </a> <a class="flex self-end items-center gap-2" href="https://www.instagram.com/kimjbaran/" target="_blank"> <span>Instagram</span> <svg aria-hidden="true" class="astro-yzt5nm4y astro-lq7oo3uf" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M17.3 5.5a1.2 1.2 0 1 0 1.2 1.2 1.2 1.2 0 0 0-1.2-1.2ZM22 7.9a7.6 7.6 0 0 0-.4-2.5 5 5 0 0 0-1.2-1.7 4.7 4.7 0 0 0-1.8-1.2 7.3 7.3 0 0 0-2.4-.4L12 2H7.9a7.3 7.3 0 0 0-2.5.5 4.8 4.8 0 0 0-1.7 1.2 4.7 4.7 0 0 0-1.2 1.8 7.3 7.3 0 0 0-.4 2.4L2 12v4.1a7.3 7.3 0 0 0 .5 2.4 4.7 4.7 0 0 0 1.2 1.8 4.8 4.8 0 0 0 1.8 1.2 7.3 7.3 0 0 0 2.4.4l4.1.1h4.1a7.3 7.3 0 0 0 2.4-.5 4.7 4.7 0 0 0 1.8-1.2 4.8 4.8 0 0 0 1.2-1.7 7.6 7.6 0 0 0 .4-2.5L22 12V7.9ZM20.1 16a5.6 5.6 0 0 1-.3 1.9A3 3 0 0 1 19 19a3.2 3.2 0 0 1-1.1.8 5.6 5.6 0 0 1-1.9.3H8a5.7 5.7 0 0 1-1.9-.3A3.3 3.3 0 0 1 5 19a3 3 0 0 1-.7-1.1 5.5 5.5 0 0 1-.4-1.9l-.1-4V8a5.5 5.5 0 0 1 .4-1.9A3 3 0 0 1 5 5a3.1 3.1 0 0 1 1.1-.8A5.7 5.7 0 0 1 8 3.9l4-.1h4a5.6 5.6 0 0 1 1.9.4A3 3 0 0 1 19 5a3 3 0 0 1 .7 1.1A5.6 5.6 0 0 1 20 8l.1 4v4ZM12 6.9a5.1 5.1 0 1 0 5.1 5.1A5.1 5.1 0 0 0 12 6.9Zm0 8.4a3.3 3.3 0 1 1 3.3-3.3 3.3 3.3 0 0 1-3.3 3.3Z"></path></svg> </a> <a class="flex self-end items-center gap-2" href="https://github.com/KimJBaran/" target="_blank"> <span>GitHub</span> <svg aria-hidden="true" class="astro-tfgvj2mv astro-lq7oo3uf" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M12 .3a12 12 0 0 0-3.8 23.38c.6.12.83-.26.83-.57L9 21.07c-3.34.72-4.04-1.61-4.04-1.61-.55-1.39-1.34-1.76-1.34-1.76-1.08-.74.09-.73.09-.73 1.2.09 1.83 1.24 1.83 1.24 1.08 1.83 2.81 1.3 3.5 1 .1-.78.42-1.31.76-1.61-2.67-.3-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.24-3.22-.14-.3-.54-1.52.1-3.18 0 0 1-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.28-1.55 3.29-1.23 3.29-1.23.64 1.66.24 2.88.12 3.18a4.65 4.65 0 0 1 1.23 3.22c0 4.61-2.8 5.63-5.48 5.92.42.36.81 1.1.81 2.22l-.01 3.29c0 .31.2.69.82.57A12 12 0 0 0 12 .3Z"></path></svg> </a> <a class="flex self-end items-center gap-2" href="https://www.linkedin.com/in/joachim-baran-22594745/" target="_blank"> <span>LinkedIn</span> <svg aria-hidden="true" class="astro-yzt5nm4y astro-lq7oo3uf" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1.5rem;"><path d="M20.47 2H3.53a1.45 1.45 0 0 0-1.47 1.43v17.14A1.45 1.45 0 0 0 3.53 22h16.94a1.45 1.45 0 0 0 1.47-1.43V3.43A1.45 1.45 0 0 0 20.47 2ZM8.09 18.74h-3v-9h3v9ZM6.59 8.48a1.56 1.56 0 0 1 0-3.12 1.57 1.57 0 1 1 0 3.12Zm12.32 10.26h-3v-4.83c0-1.21-.43-2-1.52-2A1.65 1.65 0 0 0 12.85 13a2 2 0 0 0-.1.73v5h-3v-9h3V11a3 3 0 0 1 2.71-1.5c2 0 3.45 1.29 3.45 4.06v5.18Z"></path></svg> </a> <span class="flex self-end">
&copy; 2025 Kim J. Baran.
</span> </footer> </body></html>